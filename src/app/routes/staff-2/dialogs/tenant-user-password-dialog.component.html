<div class="dialog-header">
  <h2>
    <mat-icon>lock_reset</mat-icon>
    Reset Password
  </h2>
</div>

<mat-dialog-content>
  <div class="user-info">
    <mat-list>
      <mat-list-item>
        <mat-icon matListItemIcon>person</mat-icon>
        <div matListItemTitle>{{ data.firstName }} {{ data.lastName }}</div>
        <div matListItemLine>{{ data.username }} - {{ data.email }}</div>
      </mat-list-item>
    </mat-list>
  </div>

  <div class="warning-message">
    <mat-icon>warning</mat-icon>
    <p>
      This action will reset the user's password. They will need to use the new password to log
      in.
    </p>
  </div>

  <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>New Password</mat-label>
      <input
        matInput
        formControlName="newPassword"
        [type]="hidePassword ? 'password' : 'text'"
        autocomplete="new-password"
      />
      <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" type="button">
        <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
      </button>
      @if (passwordForm.get('newPassword')?.hasError('required')) {
        <mat-error>Password is required</mat-error>
      }
      @if (passwordForm.get('newPassword')?.hasError('minlength')) {
        <mat-error>Password must be at least 8 characters</mat-error>
      }
      @if (passwordForm.get('newPassword')?.hasError('pattern')) {
        <mat-error>Password must contain uppercase, lowercase, and number</mat-error>
      }
      <mat-hint>Min 8 characters, must include uppercase, lowercase, and number</mat-hint>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Confirm Password</mat-label>
      <input
        matInput
        formControlName="confirmPassword"
        [type]="hidePassword ? 'password' : 'text'"
        autocomplete="new-password"
      />
      @if (passwordForm.get('confirmPassword')?.hasError('required')) {
        <mat-error>Please confirm the password</mat-error>
      }
      @if (passwordForm.hasError('passwordMismatch')) {
        <mat-error>Passwords do not match</mat-error>
      }
    </mat-form-field>

    <div class="password-strength">
      <h4>Password Strength</h4>
      <div class="strength-indicator">
        <div class="strength-bar" [class]="getPasswordStrengthClass()"></div>
      </div>
      <span class="strength-text">{{ getPasswordStrengthText() }}</span>
    </div>

    <mat-slide-toggle formControlName="temporary" class="full-width">
      Force password change on next login
    </mat-slide-toggle>

    @if (passwordForm.get('temporary')?.value) {
      <div class="info-message">
        <mat-icon>info</mat-icon>
        <p>The user will be required to set a new password when they next log in.</p>
      </div>
    }
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()" [disabled]="isLoading">Cancel</button>
  <button
    mat-raised-button
    color="warn"
    (click)="onSubmit()"
    [disabled]="passwordForm.invalid || isLoading"
  >
    @if (isLoading) {
      <mat-spinner diameter="20" class="btn-spinner"></mat-spinner>
    } @else {
      <span class="btn-content">
        <mat-icon>lock_reset</mat-icon>
        <span>Reset Password</span>
      </span>
    }
  </button>
</mat-dialog-actions>