<div class="dialog-header">
  <h2>
    <mat-icon>lock_reset</mat-icon>
    {{ 'staff.password_dialog.title' | translate }}
  </h2>
</div>

<mat-dialog-content>
  <div class="user-info">
    <mat-list>
      <mat-list-item>
        <mat-icon matListItemIcon>person</mat-icon>
        <div matListItemTitle>{{ data.firstName }} {{ data.lastName }}</div>
        <div matListItemLine>{{ data.username }} - {{ data.email }}</div>
      </mat-list-item>
    </mat-list>
  </div>

  <div class="warning-message">
    <mat-icon>warning</mat-icon>
    <p>
      {{ 'staff.password_dialog.warning_message' | translate }}
    </p>
  </div>

  <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
    <mat-form-field class="full-width">
      <mat-label>{{ 'staff.password_dialog.fields.new_password' | translate }}</mat-label>
      <input
        matInput
        formControlName="newPassword"
        [type]="hidePassword ? 'password' : 'text'"
        autocomplete="new-password"
      />
      <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" type="button">
        <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
      </button>
      @if (passwordForm.get('newPassword')?.hasError('required')) {
        <mat-error>{{ 'staff.password_dialog.errors.password_required' | translate }}</mat-error>
      }
      @if (passwordForm.get('newPassword')?.hasError('minlength')) {
        <mat-error>{{ 'staff.password_dialog.errors.password_min_length' | translate }}</mat-error>
      }
      @if (passwordForm.get('newPassword')?.hasError('pattern')) {
        <mat-error>{{ 'staff.password_dialog.errors.password_pattern' | translate }}</mat-error>
      }
      <mat-hint>{{ 'staff.password_dialog.password_hint' | translate }}</mat-hint>
    </mat-form-field>

    <mat-form-field class="full-width">
      <mat-label>{{ 'staff.password_dialog.fields.confirm_password' | translate }}</mat-label>
      <input
        matInput
        formControlName="confirmPassword"
        [type]="hidePassword ? 'password' : 'text'"
        autocomplete="new-password"
      />
      @if (passwordForm.get('confirmPassword')?.hasError('required')) {
        <mat-error>{{ 'staff.password_dialog.errors.confirm_required' | translate }}</mat-error>
      }
      @if (passwordForm.hasError('passwordMismatch')) {
        <mat-error>{{ 'staff.password_dialog.errors.password_mismatch' | translate }}</mat-error>
      }
    </mat-form-field>

    <div class="password-strength">
      <h4>{{ 'staff.password_dialog.password_strength' | translate }}</h4>
      <div class="strength-indicator">
        <div class="strength-bar" [class]="getPasswordStrengthClass()"></div>
      </div>
      <span class="strength-text">{{ getPasswordStrengthText() }}</span>
    </div>

    <mat-slide-toggle formControlName="temporary" class="full-width">
      {{ 'staff.password_dialog.force_change' | translate }}
    </mat-slide-toggle>

    @if (passwordForm.get('temporary')?.value) {
      <div class="info-message">
        <mat-icon>info</mat-icon>
        <p>{{ 'staff.password_dialog.force_change_info' | translate }}</p>
      </div>
    }
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()" [disabled]="isLoading">{{ 'staff.password_dialog.actions.cancel' | translate }}</button>
  <button
    mat-raised-button
    color="warn"
    (click)="onSubmit()"
    [disabled]="passwordForm.invalid || isLoading"
  >
    @if (isLoading) {
      <mat-spinner diameter="20" class="btn-spinner"></mat-spinner>
    } @else {
      <span class="btn-content">
        <mat-icon>lock_reset</mat-icon>
        <span>{{ 'staff.password_dialog.actions.reset' | translate }}</span>
      </span>
    }
  </button>
</mat-dialog-actions>