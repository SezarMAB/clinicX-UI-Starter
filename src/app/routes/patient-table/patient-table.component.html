<!-- Desktop and Mobile View using mtx-grid -->
<mtx-grid
  [data]="patients"
  [columns]="columns"
  [loading]="isLoading"
  [pageOnFront]="false"
  [showPaginator]="true"
  [pageSizeOptions]="[10, 20, 50, 100]"
  [pageIndex]="pageIndex"
  [pageSize]="pageSize"
  [length]="totalElements"
  [rowHover]="true"
  [rowStriped]="false"
  [showToolbar]="false"
  [columnSortable]="true"
  [columnHideable]="false"
  [columnPinnable]="false"
  [columnResizable]="false"
  [rowSelectable]="false"
  [cellSelectable]="false"
  [trackBy]="trackByFn"
  (page)="onPageChange($event)"
  (sortChange)="onSortChange($event)"
  class="patient-grid"
>
</mtx-grid>

<!-- Mobile Card View (kept as fallback for very small screens) -->
@if (isMobile && false) {
<div class="mobile-container">
  <!-- Loading Overlay -->
  @if (isLoading && patients.length > 0) {
    <div class="loading-overlay">
      <mat-spinner diameter="40"></mat-spinner>
    </div>
  }
  
  <!-- Mobile Cards -->
  <div class="mobile-cards">
    @for (patient of patients; track patient.id) {
      <mat-card class="patient-card" [class.has-alert]="patient.hasAlert">
        <mat-card-header>
          <mat-card-title>
            {{ patient.fullName }}
            @if (patient.hasAlert) {
              <mat-icon class="alert-icon" matTooltip="Patient has alerts">warning</mat-icon>
            }
          </mat-card-title>
          <mat-card-subtitle>ID: {{ patient.publicFacingId }}</mat-card-subtitle>
        </mat-card-header>
        
        <mat-card-content>
          <div class="patient-info">
            <div class="info-row">
              <span class="label">Phone:</span>
              @if (patient.phoneNumber) {
                <a href="tel:{{ patient.phoneNumber }}" class="value link">{{ patient.phoneNumber }}</a>
              } @else {
                <span class="value">-</span>
              }
            </div>
            
            <div class="info-row">
              <span class="label">Email:</span>
              @if (patient.email) {
                <a href="mailto:{{ patient.email }}" class="value link truncate">{{ patient.email }}</a>
              } @else {
                <span class="value">-</span>
              }
            </div>
            
            <div class="info-row">
              <span class="label">Age:</span>
              <span class="value">{{ patient.age }} years</span>
            </div>
            
            <div class="info-row">
              <span class="label">Gender:</span>
              <span class="value">
                <span class="gender-symbol" 
                      [class.male]="patient.gender === 'M' || patient.gender === 'Male'" 
                      [class.female]="patient.gender === 'F' || patient.gender === 'Female'">
                  {{ getGenderSymbol(patient.gender) }}
                </span>
                {{ patient.gender }}
              </span>
            </div>
            
            <div class="info-row">
              <span class="label">Balance:</span>
              <span class="value" 
                    [class.text-green]="patient.balance >= 0"
                    [class.text-red]="patient.balance < 0">
                {{ formatBalance(patient.balance) }}
              </span>
            </div>
          </div>
        </mat-card-content>
        
        <mat-card-actions>
          <button mat-button color="primary" (click)="onViewPatient(patient)">
            <mat-icon>visibility</mat-icon>
            View
          </button>
          <button mat-button (click)="onEditPatient(patient)">
            <mat-icon>edit</mat-icon>
            Edit
          </button>
          <button mat-icon-button [matMenuTriggerFor]="mobileMenu">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #mobileMenu="matMenu">
            <button mat-menu-item>
              <mat-icon>calendar_today</mat-icon>
              <span>Schedule Appointment</span>
            </button>
            <button mat-menu-item>
              <mat-icon>attach_money</mat-icon>
              <span>Add Payment</span>
            </button>
          </mat-menu>
        </mat-card-actions>
      </mat-card>
    }
    
    <!-- No Data Message -->
    @if (patients.length === 0 && !isLoading) {
      <div class="no-data-mobile">
        @if (searchTerm || activeFilterCount > 0) {
          No patients found matching your search criteria
        } @else {
          No patients available
        }
      </div>
    }
  </div>
</div>
}