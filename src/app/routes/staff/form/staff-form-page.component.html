<div class="form-container">
  <div class="form-header">
    <button mat-icon-button (click)="cancel()">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h1>{{ pageTitle }}</h1>
  </div>
  
  <mat-card>
    <mat-card-content>
      <form [formGroup]="staffForm" (ngSubmit)="onSubmit()">
        <div class="form-section">
          <h3>Basic Information</h3>
          
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Full Name</mat-label>
            <input matInput formControlName="fullName" placeholder="Enter full name">
            @if (getErrorMessage('fullName')) {
              <mat-error>{{ getErrorMessage('fullName') }}</mat-error>
            }
          </mat-form-field>
          
          <div class="form-row">
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Role</mat-label>
              <mat-select formControlName="role">
                @for (role of staffRoles; track role) {
                  <mat-option [value]="role">{{ role }}</mat-option>
                }
              </mat-select>
              @if (getErrorMessage('role')) {
                <mat-error>{{ getErrorMessage('role') }}</mat-error>
              }
            </mat-form-field>
            
            @if (isEditMode) {
              <mat-slide-toggle formControlName="isActive" class="status-toggle">
                @if (staffForm.get('isActive')?.value) {
                  <span>Active</span>
                } @else {
                  <span>Inactive</span>
                }
              </mat-slide-toggle>
            }
          </div>
        </div>
        
        <mat-divider></mat-divider>
        
        <div class="form-section">
          <h3>Contact Information</h3>
          
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Email</mat-label>
            <input matInput formControlName="email" placeholder="Enter email address" type="email">
            @if (getErrorMessage('email')) {
              <mat-error>{{ getErrorMessage('email') }}</mat-error>
            }
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Phone Number</mat-label>
            <input matInput formControlName="phoneNumber" placeholder="Enter phone number (optional)">
            @if (getErrorMessage('phoneNumber')) {
              <mat-error>{{ getErrorMessage('phoneNumber') }}</mat-error>
            }
          </mat-form-field>
        </div>
        
        @if (!isEditMode) {
          <mat-divider></mat-divider>
          
          <div class="form-section">
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title>
                  Keycloak User Settings (Optional)
                </mat-panel-title>
              </mat-expansion-panel-header>
              
              <mat-slide-toggle formControlName="createKeycloakUser" class="keycloak-toggle">
                Create Keycloak User
              </mat-slide-toggle>
              
              @if (createKeycloakUser) {
                <div class="keycloak-fields">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Password</mat-label>
                    <input matInput formControlName="password" type="password" placeholder="Enter password">
                    <mat-hint>Minimum 8 characters</mat-hint>
                    @if (getErrorMessage('password')) {
                      <mat-error>{{ getErrorMessage('password') }}</mat-error>
                    }
                  </mat-form-field>
                  
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Username</mat-label>
                    <input matInput formControlName="username" placeholder="Enter username (optional)">
                    <mat-hint>Defaults to email if not provided</mat-hint>
                  </mat-form-field>
                  
                  <div class="form-row">
                    <mat-form-field appearance="outline" class="half-width">
                      <mat-label>First Name</mat-label>
                      <input matInput formControlName="firstName" placeholder="Enter first name (optional)">
                    </mat-form-field>
                    
                    <mat-form-field appearance="outline" class="half-width">
                      <mat-label>Last Name</mat-label>
                      <input matInput formControlName="lastName" placeholder="Enter last name (optional)">
                    </mat-form-field>
                  </div>
                  
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Access Role</mat-label>
                    <input matInput formControlName="accessRole" placeholder="Enter access role (optional)">
                    <mat-hint>Defaults to staff role if not provided</mat-hint>
                  </mat-form-field>
                  
                  <mat-slide-toggle formControlName="isPrimaryTenant">
                    Set as Primary Tenant
                  </mat-slide-toggle>
                </div>
              }
              
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Existing Keycloak User ID</mat-label>
                <input matInput formControlName="keycloakUserId" placeholder="Link to existing user (optional)">
                <mat-hint>If provided, will link to existing Keycloak user</mat-hint>
              </mat-form-field>
            </mat-expansion-panel>
          </div>
        }
        
        <div class="form-actions">
          <button mat-button type="button" (click)="cancel()">Cancel</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="loading">
            @if (loading) {
              <mat-spinner diameter="20"></mat-spinner>
            } @else {
              {{ isEditMode ? 'Update' : 'Create' }}
            }
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>